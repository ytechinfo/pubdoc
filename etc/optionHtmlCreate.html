<!doctype html>

<html>
<title>옵션생성</title>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="/assets/css/bootstrap.min.css" rel="stylesheet">
<link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/pub-style.css" rel="stylesheet">
<link href="./optionCreate.css" rel="stylesheet">


<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery-ui.min.js"></script>
<script src="/assets/js/mustache/mustache.min.js"></script>
        
</head>

<body>
    <table class="content-body">
        <tr>
            <th style="width:50%;">
             옵션   
            </th>
            <th style="width:50%;">
                <a href="javascript:;" class="opt-change">html 변경.</a> 
            </th>
        </tr>
        <tr>
            <td>
<textarea id="optionText">
    {
        blankSpaceWidth : 1		// 오른쪽 끝 공백 값
        ,copyMode : 'single'		// copy mode	single, multiple, none
        ,colFixedIndex : 0	// 고정 컬럼
        ,widthFixed : false  // 넓이 고정 여부.
        ,useDefaultFormatter: true // 기본 포멧터 사용여부
        ,editable :false	// 편집 모드 활성화
        ,selectionMode : 'multiple-cell'	// row , cell , multiple-row , multiple-cell	// 선택 방법.
        ,showTooltip : false			// tooltip flag
        ,theme : 'light'
        ,height: 'auto'
        ,width: 'auto'
        ,itemMaxCount : -1	// add시 item max로 유지할 카운트
        ,colOptions : {	// 컬럼 옵션
            minWidth : 50  // 컬럼 최소 넓이
            ,maxWidth : -1  // 컬럼 최대 넓이
        }
        ,rowOptions:{	// 로우 옵션.
            height: 22	// cell 높이
            ,click : false //row(tr) click event
            ,contextMenu : false // row(tr) contextmenu event
            ,addStyle : false	// 추가할 style method
            ,dblClick : false	// row dblclick event
            ,dblClickCheck : false	// double click row checkbox checked true 여부.
            ,pasteBefore :false
            ,pasteAfter :false
        }
        ,formatter :{
            money :{prefix :'$', suffix :'원' , fixed : 0}	// money 설정 prefix 앞에 붙일 문구 , suffix : 마지막에 뭍일것 , fixed : 소수점
            ,number : {prefix :'', suffix :'' , fixed : 0}
        }
        ,autoResize : {	//리사이즈 설정
            enabled:true	// 리사이즈시 그리드 리사이즈 여부.
            ,responsive : true
            ,threshold :150
        }
        ,headerOptions : {
            view : true	// header 보기 여부
            ,height: 25
            ,sort : true	// 초기에 정렬할 값
            ,redraw : true	// 초기에 옵션 들어오면 새로 그릴지 여부.
            ,resize:{	// resize 설정
                enabled : true			// 활성화여부
                ,cursor : 'col-resize'	// 커서 모양
                ,update : false			// 변경시 콜랙 함수
            }
            ,isColSelectAll : true	// 전체 선택 여부.
            ,scrollEnabled : true	// 마우스 휠로 가로 스크롤 이동할지 여부.
            ,oneCharWidth: 7
            ,viewAllLabel : true
            ,contextMenu : false // header contextmenu event
            ,helpBtn:{			//	header help btn 설정
                enabled : false	// header help btn 활성 여부.
                ,title : ''
                ,click :  function (clickInfo){}	// click event
                ,dblclick : function (clickInfo){} // double click event
            }
        }
        ,setting : {					// 그리드 설정
            mode :'simple'				// simple (search , fixed) , full(column config , filter) , full-center(screen center)
            ,enabled : false			// 활성여부
            ,enableColumnFix : false	// 고정 컬럼 활성여부
            ,click : false				// 직접 처리 할경우. function 으로 처리.
            ,speedMaxVal :10			// 스크롤 스피드
            ,callback : function (item){
    
            }
            ,configVal :{
                search :{			// 검색
                    field : ''		// 검색 필드
                    ,val : ''		// 검색어
                }
                ,speed :-1			// scroll speed
                ,fixColumnPosition : -1	// fixed col position
            }
            ,util : {
                searchFilter : function (item, key, schRegExp){
                    var itemVal = (item[key]||'')+'';
    
                    if(schRegExp.test(itemVal)){
                        return true;
                    }
                    return false;
                }
            }
        }
        ,asideOptions :{	// aside 옵션
            lineNumber : {	// 번호
                enabled :false
                ,key : 'lineNumber'
                ,charWidth : 9
                ,name : ''
                ,width : 40
                ,styleCss : ''	//css
                ,isSelectRow:true
            }
            ,rowSelector :{	// 체크 박스
                enabled :false
                ,key : 'checkbox'
                ,name : 'V'
                ,width : 25
                ,click : function (rowInfo){ // click event , return false 일경우 체크 안함.
    
                }
            }
            ,modifyInfo :{	// 수정 여부
                enabled :false
                ,key : 'modify'
                ,name : 'modify'
                ,width : 10
            }
        }
        ,bodyOptions : {	// body option
            cellDblClick : false	// body td click
            ,keyNavHandler : false // arrows key handler function
        }
        ,scroll :{	// 스크롤 옵션
            isStopPropagation : false	// 이벤트 전파 여부.
            ,vertical : {
                width : 14			// 세로 스크롤
                ,bgDelay : 100		// 스크롤 빈공간 mousedown delay
                ,btnDelay : 100		// 방향키 mousedown delay
                ,dragDelay : 5		// 스크롤 bar drag delay
                ,speed : 1			// 스크롤 스피드 row 1
                ,onUpdate : function (item){	// 스크롤 업데이트.
                    return true;
                }
                ,tooltip : false		// item count tooltip
    
            }
            ,horizontal :{
                height: 14			// 가로 스크롤 높이
                ,bgDelay : 100
                ,btnDelay : 100		// 방향키 버튼 속도.
                ,dragDelay : 7		// 스크롤 bar drag delay
                ,speed : 1			// 스크롤 스피드
    
            }
        }
        /*
        tColItem  object info
        {
          "key": "b"	// key
          ,"label": "비"	// label
          ,"width": 100		// width
          ,"sort": true		// sort flag
          ,"align": "center"	// align
          ,"type": "money"		// value type
          ,"render": "html"		// render mode (html or text default text)
          ,formatter : function (obj){	// 보여질 값을 처리.
                return obj.item.STATE;
          }
          ,defaultValue : ''	// add item default value
          ,colClick :function (idx,item){ console.log(idx, item)}		// cell click event
          ,styleClass : function (idx, item){return 'pub-bg-private';}	// cell add class
          ,tooltip : {
             show : true	// 툴팁 보일지 여부.
             ,formatter : function (obj){	// 툴팁 내용
                return obj.val;
             }
          }
          ,editor : {
            type : "text", "text, select, textarea, number, custom"
            editorBtn : false,		// 버튼 보일지 여부.
            editorBtnOver : false, // 오버시 버튼 보이기
            items : [],
            validator : function (){}
          }
    
        }
        */
        ,tColItem : [] //head item
        ,theadGroup : [] // head group
        ,tbodyItem : []  // body item
        ,tbodyGroup : [] // body group
        ,tfootItem : []  // foot item
        ,navigation :{
            usePaging : false
            ,status : false
            ,height : 35
            ,callback : function (no){}
        }
        ,page : false	// paging info
        ,message : {
            empty : 'no data'
            ,pageStatus : function (status){
                return status.currStart +' - ' + status.currEnd+' of '+ status.total;
            }
        }
        ,i18n :{
            'setting.label' : '설정'
            ,'search.button' : '검색'
            ,'setting.speed.label' : '스크롤속도'
            ,'setting.column.fixed.label' : '고정컬럼'
        }
        ,icon : {
            'sortup' : '<svg width="8px" height="8px" viewBox="0 0 110 110" style="enable-background:new 0 0 100 100;"><g><polygon points="50,0 0,100 100,100" fill="#737171"></polygon></g></svg>'
            ,'sortdown' : '<svg width="8px" height="8px" viewBox="0 0 110 110" style="enable-background:new 0 0 100 100;"><g><polygon points="0,0 100,0 50,90" fill="#737171"></polygon></g></svg>'
        }
        ,operators : {} // setting condition operator
    }
</textarea>
            </td>
            <td>
<div class="result-area">
    result code
    <textarea id="changeHtml" style="width:100%;" rows="4"></textarea>
    
    result html
    <div id="resultSourceArea">
        <table class="option-desc-area">
            <thead>
                <tr>
                    <th>옵션명</th>
                    <th>옵션값</th>
                </tr>
            </thead>
            <tbody id="optDescPreviewArea">

            </tbody>
        </table>
    </div>
</div>
            </td>
        </tr>
    </table>
    
</body>
</html>

<script>
var optionsChg = {
    excludeKey : ['icon'] // 제외 키 하위 구분자 (;)
    ,init : function (){
        this.initEvt();
    }
    // 이벤트 초기화
    ,initEvt : function (){
        var _this =this; 

        $('.opt-change').on('click',function (){
            _this.change();

            $('#changeHtml').val($.trim($('#resultSourceArea').html()));
        });
        $('.opt-change').trigger('click');


    }
    // 옵션 변경. 
    ,change : function (){
        var optText = $('#optionText').val();

        var optObj = new Function('return '+ optText+';')();

        var strHtm = this.getOptHtml(optObj, '', false,optText);
      
        $('#optDescPreviewArea').empty().html(strHtm);
    }
    // option html변경. 
    ,getOptHtml : function (optObj,parentKey, childFlag ,optText){
        var strHtm = [];

        if(childFlag){
            strHtm.push('<table class="pub-option-sub-tbl">');
        }
        for(var key in optObj){
            var optObjVal = optObj[key]; 

            strHtm.push(this.getOptValTab(key, optObjVal, parentKey, optText));
        }
        if(childFlag){
            strHtm.push('</table>');
        }

        return strHtm.join('');
    }
    // 옵션 value html template생성. 
    ,getOptValTab : function (key, optObjVal, parentKey, optText){
        var strHtm = [];

        strHtm.push('<tr>');
        strHtm.push('<td class="pub-option-key">'+key+'</td>');

        var reval ='';
        var isObjectFlag = false;
        var desc = this.getDesc(key,optText);
        
        var fullKey = parentKey ==''? key : parentKey + ';'+ key; 


        if(this.excludeKey.indexOf(fullKey) > -1){
            return '';
        }

        if($.isNumeric(optObjVal)){
            reval ='<input type="number" data-key="'+key+'" data-full-key="'+fullKey+'" name="'+fullKey+'" class="item-val" data-default="'+(optObjVal)+'" value="'+optObjVal+'">';
            //reval= this.getSelectBoxVal(key,fullKey, optObjVal);
        }else if(typeof optObjVal=== 'boolean'){
            var flag = optObjVal ==true;  
            reval+='<input type="radio" data-key="'+key+'" data-full-key="'+fullKey+'" name="'+fullKey+'" class="item-val" data-default="'+(flag===true?'Y':'')+'" value="true" '+(flag===true?'checked':'')+'>true';
            reval+='<input type="radio" data-key="'+key+'" data-full-key="'+fullKey+'" name="'+fullKey+'" class="item-val" data-default="'+(flag===false?'Y':'')+'" value="false" '+(flag===false?'checked':'')+'>false';
        }else if(typeof optObjVal=== 'string'){
            reval= '<input type="text" data-key="'+key+'" data-full-key="'+fullKey+'" name="'+fullKey+'" class="item-val"  data-default="'+(optObjVal)+'" value="'+optObjVal+'" >';
        }else if(Array.isArray(optObjVal)){
            reval ='array value';
        }else if(typeof optObjVal=== 'function'){
            reval ='function value';
        }else if(typeof optObjVal=== 'object'){
            isObjectFlag = true; 
            reval ='<div class="obj-desc">'+desc+'</div>'+this.getOptHtml(optObjVal, fullKey, true, optText);
        }

        strHtm.push('<td class="pub-option-val"><div>'+reval+'</div>'+(!isObjectFlag?'<div class="field-desc">'+desc+'</div>':'')+'</td>');
        strHtm.push('</tr>');

        return strHtm.join('');
    }
    // select box value 
    ,getSelectBoxVal:function (key,fullKey,optObjVal){
        var reval = [];
        reval.push('<select class="item-val" data-key="'+key+'" data-full-key="'+fullKey+'" data-default="'+(optObjVal)+'">')
        if(optObjVal== -1){
            reval.push('<option value="-1" selected>-1<option>');
            for(var i=1; i<= 5;i++){
                var val = i*1000;
                reval.push('<option value="'+val+'">'+val+'</option>');
            }
        }else{
            for(var i=0; i<= 10;i++){
                var val = i;
                reval.push('<option value="'+val+'" '+(i==optObjVal?'selected':'')+'>'+val+'</option>');
            }
        }
        reval.push('<select>')

        return reval.join('');
    }
    // 설명 추출
    ,getDesc : function (key,optText){
        
        var regStr = '.*('+key+'|'+key+"\\s):\\s.*//.*\n";
        var regExp = new RegExp(regStr, "gm");
        var matches = regExp.exec(optText); 
        
        var remarks ='설명';
        if(matches && matches.length > 0){
            remarks = matches[0].replace(/.*\/\/\s/,'')
        }

        //console.log(regStr,matches,remarks,optText)
        return remarks;

    }
}

optionsChg.init();
</script>


